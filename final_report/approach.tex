\section{Approach}\label{sec:approach}

\subsection{Developing a Fault Model}\label{sec:developingmodel}


\subsection{Building the Fault Model in M\"obius}\label{sec:buildingmodel}

We chose to motivate the development of the boot protection script by developing a SAN model in M\"obius.

We choose to measure reliability as the relevant dependability metric because the continuous operation of the satellite is critical to the IlliniSAT team; furthermore, the failure that we are modeling is catastrophic.  As the satellite cannot recover from any failure of this type, it does not make sense to measure the system's availability.

The parameters used in this model are shown in Table \ref{tab:parameters}.

\begin{table}[width = 0.5\textwidth]
\centering
\begin{tabular}{|c|c|c|c|}
\hline
{\bf Parameter Name} & {\bf Description} & {\bf Value} & {\bf Source}\\
\hline
\texttt{seu\_rate} & SEU event rate & & \\
\hline
\end{tabular}
\caption{Parameters used in the M\"obius model}
\label{tab:parameters}
\end{table}
\subsection{Boot Protection}
The C\&DH system uses a Linux kernel that is booted by
U-boot.\footnote{\url{http://www.denx.de/wiki/U-Boot}} The fault model
considered here is bit corruption in the Linux kernel that is present at boot
time.  Currently, there is only one copy of the Linux kernel and if it fails to
boot, the entire C\&DH system will experience catastrophic failure.  The
solution described below is designed to reduce that single point of failure to a
much smaller region of code.  When considering the reliability of U-boot itself,
the C\&DH board already uses the MLO bootloader with redundant U-Boot images.

\subsubsection{Test Environment}
In order to develop and test the boot protection system in a controlled
environment, we decided to use an ARM emulator.  The QEMU~\cite{bellard2005qemu}
emulator is well known and supports a variety of architectures, including
several ARM development boards.  It does not currently support the MityARM board
used by IlliniSat, so we use the ``versatilepb'' virtual development board to
run U-boot and Linux compiled for
ARM.\footnote{\url{http://elinux.org/Virtual_Development_Board}}

The initial bulk of this work involved getting the test environment running and
we have made detailed notes so that we can share this procedure with others
working on similar problems.  The versatilepb board in QEMU has a virtual flash
drive that is memory mapped to address 0x3400000, which we use to store the
contents of the OS kernel images and the boot protection scheme.

\subsubsection{Implementation}
U-Boot has built-in support for CRC-32, and every image (e.g. application, OS,
script, filesystem, etc...) is stored in a format that contains this checksum.
Therefore, one can use this built-in functionality to validate checksums.
U-Boot can be configured with a script interpreter that will run pre-complied
scripts that are very similar to typical Unix shell scripts. Using this
functionality, we developed a script that will check kernel images before
booting. The script iterates through multiple kernel images until it finds one
with a valid CRC checksum and boots that one.  If not valid checksums are found,
it will attempt to boot the first image.  

Figure \label{fig:mem_map} shows the memory map of the boot protection scheme
used in the QEMU test environment.  In this case, the script is 914B and each
kernel image is 1.7MB.  Without this scheme, the Linux kernel image was a
single-point-of-failure during the boot process (or one could boot a faulty
kernel and have other failures at a later time).  The script effectively reduces
the area vulnerable to bit errors by three orders of magnitude (1.7MB/914B =
1950).  It is important to note that since the QEMU development environment used
a memory-mapped flash device, the kernels are shown as being contiguous in
memory.  However, it would be trivial to modify the script to load the kernels
from a separate device (e.g. an SD card, as found on the MityARM335x).

%(1.7 megabytes) / (914 bytes) = 1950.30547

%Include: SD card and memory map stuff
\begin{figure}
  \centering
  \includegraphics[width=0.15\textwidth]{images/mem_map}
  \caption{The memory map used to evaluate the boot protection system in QEMU.
           The U-boot application itself occupies 0.17MB, whereas the protection
           script is 914 bytes and each Linux kernel is
           1.7MB.}\label{fig:mem_map}
\end{figure}

%END BOOT - MERGE ANCHOR
\subsection{Flash Patrol Read Daemon}
